{% extends 'back.html.twig' %}

{% block title %}List of users{% endblock %}

{% block body %}
    <h1>List of users</h1>


 <div class="col-md-9">
                        
    
    
     <div class="dataTables_filter">
     <label>Search:
        <input type="search" class="form-control form-control-sm" placeholder="" aria-controls="users-table" id="search-input">
     </label>
     </div>
                           
                
                          
      <div class="outer-wrapper table-responsive">    
    <div class="table-wrapper"> 
       
    <table id="users-table" class="table table-striped table-hover">
        <thead class="thead-digitartcolor">
            <tr>
                <th>Profile Image</th>
                <th>Cin</th>
                <th>Firstname</th>
                <th>Lastname</th>
                <th>Email</th>
                <th>Address</th>
                <th>PhoneNum</th>
                <th>BirthDate</th>
                <th>Gender</th>
                <th>Role</th>
                <th>Status</th>
                <th>Created At</th>
                <th>Updated At</th>
                <th>actions</th>
            </tr>
        </thead>
        <tbody>
        {% for user in users %}
            <tr>
                {% if user.image is not null %}
                <td><img src="{{ asset('/uploads/' ~ user.image) }}" alt="Image" width="150"></td>
                {% else %}
                <td><img src="{{ asset('Back/images/icon-profile.png') }}" alt="Image" width="150"></td>
                {% endif %}
                <td>{{ user.cin }}</td>
                <td>{{ user.firstname }}</td>
                <td>{{ user.lastname }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.address }}</td>
                <td>{{ user.phoneNum }}</td>
                <td>{{ user.birthDate ? user.birthDate|date('Y-m-d') : '' }}</td>
                <td>{{ user.gender }}</td>
                <td>{{ user.role }}</td>
                <td>{{ user.status }}</td>
                <td>{{ user.createdAt ? user.createdAt|date('Y-m-d H:i:s') : '' }}</td>
                <td>{{ user.updatedAt ? user.updatedAt|date('Y-m-d H:i:s') : '' }}</td>
                <td>

                 <div class="d-flex">
                    <a href="{{ path('app_users_show', {'id': user.id}) }}">
                    <button type="button" class="btn btn-outline-info mr-2">
                    <i class="fa fa-question-circle"></i>
                    </button></a>

                    <a href="{{ path('app_users_edit', {'id': user.id}) }}">
                    <button type="button" class="btn btn-outline-dark mr-2">
                    <i class="fa fa-pencil-square"></i>
                    </button></a>

                    <a href="{{ path('app_users_updatestatus', {'id': user.id, 'newStatus': 'blocked'}) }}">
               <button type="button" class="btn btn-outline-danger mr-2">
               <i class="fa fa-lock"></i>
              </button>
              </a>

<a href="{{ path('app_users_updatestatus', {'id': user.id, 'newStatus': 'unblocked'}) }}">
    <button type="button" class="btn btn-outline-success mr-2">
    <i class="fa  fa-unlock"></i>
    </button>
</a>

                  </div>

                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="15">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
    
    
     </div>
 </div>
 
  <script>
    $(document).ready(function () {
        $('#search-input').on('keyup', function () {
            var searchTerm = $(this).val();
            $.ajax({
                url: "{{ path('app_users_search') }}",
                method: 'POST',
                data: {searchTerm: searchTerm},
                success: function (data) {
                    console.log(data); // log response data to console
                   var users = data.users;
    var tableBody = $('#users-table tbody');
    tableBody.empty();
    if (users.length === 0) {
        tableBody.append('<tr><td colspan="12">No results found</td></tr>');
    } else {
        users.forEach(function (user) {
            var row = '<tr>' +
                '<td>' + user.cin + '</td>' +
                '<td>' + user.firstname + '</td>' +
                '<td>' + user.lastname + '</td>' +
                '<td>' + user.email + '</td>' +
                '<td>' + user.password + '</td>' +
                '<td>' + user.address + '</td>' +
                '<td>' + user.phoneNum + '</td>' +
                '<td>' + user.birthDate ? user.birthDate|date('Y-m-d') : '' + '</td>' +
                '<td>' + user.gender + '</td>' +
                '<td>' + user.role + '</td>' +
                '<td>' + user.status + '</td>' +
                '</tr>';
            tableBody.append(row);
        });
    }
                }
            });
        });
    });
</script>
                    

             
              
    <!-- <a href=" path('app_users_new') }}">Create new</a> --!>

{% endblock %}
